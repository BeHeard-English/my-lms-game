<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary with Be Heard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; padding: 15px;
            line-height: 1.6;
        }

        .container {
            max-width: 850px; margin: 0 auto;
            background: var(--card);
            padding: 25px; border-radius: 24px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.08);
        }

        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--primary); margin-bottom: 5px; }
        
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .tab-btn {
            flex: 1; padding: 14px; border: none; border-radius: 12px;
            background: #e2e8f0; cursor: pointer; font-weight: 700;
            transition: 0.3s; font-size: 0.9rem;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .pane { display: none; }
        .pane.active { display: block; }

        textarea {
            width: 100%; height: 160px; padding: 15px;
            border-radius: 12px; border: 1px solid #cbd5e1;
            box-sizing: border-box; font-family: inherit; font-size: 1rem;
        }

        .action-btn {
            width: 100%; padding: 16px; background: var(--primary);
            color: white; border: none; border-radius: 12px;
            font-weight: 800; cursor: pointer; font-size: 1.1rem; margin-top: 10px;
        }

        .quiz-area { display: none; margin-top: 30px; }
        .q-card {
            border: 1px solid #e2e8f0; padding: 20px;
            border-radius: 18px; margin-bottom: 25px;
            background: #fff; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }

        .q-text { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 15px; }

        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt {
            padding: 15px; border: 2px solid #f1f5f9;
            border-radius: 12px; cursor: pointer;
            transition: 0.2s; font-weight: 500;
        }
        .opt.selected { background: var(--primary); color: white; border-color: var(--primary); }

        .feedback {
            margin-top: 15px; padding: 15px; border-radius: 12px;
            display: none; background: #f8fafc; border-left: 5px solid var(--secondary);
        }

        .ipa-line { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .ipa-text { color: #be123c; font-weight: 700; font-family: monospace; font-size: 1.2rem; }
        
        .speak-btn {
            background: #4f46e5; color: white; border: none; border-radius: 50%;
            width: 44px; height: 44px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
        }

        .submit-btn {
            width: 100%; padding: 20px; background: var(--secondary);
            color: white; border: none; border-radius: 15px;
            font-size: 1.2rem; font-weight: 800; cursor: pointer;
        }

        #scoreBox { display: none; text-align: center; padding: 25px; border-radius: 20px; background: #0f172a; color: white; margin-bottom: 25px; }

        @media (max-width: 600px) { .options { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Vocabulary and Pronunciation</h1>
        <p>H·ªçc t·ª´ v·ª±ng c√πng Be Heard</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('fileTab', this)">üìÅ Upload Docx</button>
        <button class="tab-btn" onclick="switchTab('textTab', this)">‚úçÔ∏è Paste List</button>
    </div>

    <div id="fileTab" class="pane active">
        <div style="border: 2px dashed #cbd5e1; padding: 35px; border-radius: 18px; text-align: center; cursor: pointer; background: #f1f5f9;" onclick="document.getElementById('fileIn').click()">
            <strong id="fileInfo">Tap to upload .docx file</strong>
            <input type="file" id="fileIn" hidden accept=".docx">
        </div>
    </div>

    <div id="textTab" class="pane">
        <textarea id="rawInput" placeholder="V√≠ d·ª•: 
1. Alleviate : l√†m nh·∫π b·ªõt
- Ambivalent : m√¢u thu·∫´n"></textarea>
        <button class="action-btn" onclick="processText()">Start Practice</button>
    </div>

    <div id="scoreBox"></div>

    <div id="quizArea" class="quiz-area">
        <div id="quizContent"></div>
        <button class="submit-btn" onclick="checkAll()">Submit & View Results</button>
    </div>
</div>

<script>
    const megaBank = [
        {w: "Alleviate", i: "/…ôÀàliÀêvie…™t/", m: "L√†m nh·∫π b·ªõt", e: "The new medicine helps to alleviate the symptoms of the flu."},
        {w: "Ambivalent", i: "/√¶mÀàb…™v…ôl…ônt/", m: "M√¢u thu·∫´n trong t∆∞ t∆∞·ªüng", e: "He felt ambivalent about his new job; he loved the pay but hated the hours."},
        {w: "Anomaly", i: "/…ôÀàn…ím…ôli/", m: "S·ª± b·∫•t th∆∞·ªùng", e: "The scientific results were an anomaly and didn't fit the pattern."},
        {w: "Articulate", i: "/…ëÀêÀàt…™kjule…™t/", m: "ƒÇn n√≥i l∆∞u lo√°t", e: "She is an articulate speaker who explains complex ideas clearly."},
        {w: "Assertive", i: "/…ôÀàs…úÀêt…™v/", m: "Qu·∫£ quy·∫øt", e: "Being assertive means standing up for what you believe in."},
        {w: "Autonomous", i: "/…îÀêÀàt…ín…ôm…ôs/", m: "ƒê·ªôc l·∫≠p, t·ª± tr·ªã", e: "Teachers want their students to become more autonomous learners."},
        {w: "Benevolent", i: "/b…ôÀànev…ôl…ônt/", m: "Nh√¢n t·ª´", e: "A benevolent uncle paid for her college tuition."},
        {w: "Coherent", i: "/k…ô äÀàh…™…ôr…ônt/", m: "M·∫°ch l·∫°c", e: "He was so drunk he wasn't making any coherent sense."},
        {w: "Complacent", i: "/k…ômÀàple…™snt/", m: "T·ª± m√£n", e: "We cannot afford to become complacent about our success."},
        {w: "Concede", i: "/k…ônÀàsiÀêd/", m: "Th·ª´a nh·∫≠n", e: "The government has finally conceded that its policies were wrong."},
        {w: "Conspicuous", i: "/k…ônÀàsp…™kju…ôs/", m: "D·ªÖ th·∫•y, l·ªô li·ªÖu", e: "The bird has a conspicuous red head."},
        {w: "Corroborate", i: "/k…ôÀàr…íb…ôre…™t/", m: "X√°c minh", e: "Recent research seems to corroborate his theory."},
        {w: "Cursory", i: "/Ààk…úÀês…ôri/", m: "Qua loa", e: "He gave the report a cursory glance before the meeting."},
        {w: "Dearth", i: "/d…úÀêŒ∏/", m: "S·ª± khan hi·∫øm", e: "There is a dearth of reliable information on the subject."},
        {w: "Debilitate", i: "/d…™Ààb…™l…™te…™t/", m: "L√†m suy y·∫øu", e: "The disease can debilitate the patient for many weeks."},
        {w: "Deference", i: "/Ààdef…ôr…ôns/", m: "S·ª± t√¥n tr·ªçng", e: "He treats her with great deference because of her age."},
        {w: "Deleterious", i: "/Àådel…™Ààt…™…ôri…ôs/", m: "C√≥ h·∫°i", e: "Smoking has a deleterious effect on your health."},
        {w: "Delineate", i: "/d…™Ààl…™nie…™t/", m: "Ph√°c th·∫£o chi ti·∫øt", e: "The report clearly delineates the steps that must be taken."},
        {w: "Denounce", i: "/d…™Ààna äns/", m: "L√™n √°n", e: "The dictator's actions were denounced by world leaders."},
        {w: "Deplore", i: "/d…™Ààpl…îÀê(r)/", m: "Than phi·ªÅn, h·ªëi ti·∫øc", e: "We deplore all forms of violence."},
        {w: "Detached", i: "/d…™Ààt√¶t Ét/", m: "Th·ªù ∆°, t√°ch bi·ªát", e: "He tries to remain detached from the office politics."},
        {w: "Deterrent", i: "/d…™Ààter…ônt/", m: "S·ª± ngƒÉn ch·∫∑n", e: "Tougher prison sentences may act as a deterrent to crime."},
        {w: "Deviate", i: "/ÀàdiÀêvie…™t/", m: "Ch·ªách h∆∞·ªõng", e: "Never deviate from the original plan."},
        {w: "Didactic", i: "/da…™Ààd√¶kt…™k/", m: "C√≥ t√≠nh gi√°o hu·∫•n", e: "The story is didactic, intended to teach a moral lesson."},
        {w: "Diligent", i: "/Ààd…™l…™d í…ônt/", m: "C·∫ßn c√π", e: "He is a diligent worker who never misses a deadline."},
        {w: "Discrepancy", i: "/d…™Ààskrep…ônsi/", m: "S·ª± kh√°c bi·ªát", e: "There is a discrepancy between the two bank statements."},
        {w: "Disdain", i: "/d…™sÀàde…™n/", m: "S·ª± khinh mi·ªát", e: "He treats his rivals with total disdain."},
        {w: "Disparate", i: "/Ààd…™sp…ôr…ôt/", m: "Kh√°c bi·ªát ho√†n to√†n", e: "The two cultures are completely disparate."},
        {w: "Disseminate", i: "/d…™Ààsem…™ne…™t/", m: "Ph·ªï bi·∫øn th√¥ng tin", e: "The goal is to disseminate knowledge to everyone."},
        {w: "Divergent", i: "/da…™Ààv…úÀêd í…ônt/", m: "B·∫•t ƒë·ªìng, kh√°c nhau", e: "They have divergent opinions on the issue."},
        {w: "Dogmatic", i: "/d…í…°Ààm√¶t…™k/", m: "Gi√°o ƒëi·ªÅu", e: "He is so dogmatic that he won't listen to reason."},
        {w: "Dubious", i: "/ÀàdjuÀêbi…ôs/", m: "Nghi ng·ªù, m∆° h·ªì", e: "I am dubious about the success of this plan."},
        {w: "Ebullient", i: "/…™Ààb åli…ônt/", m: "S√¥i n·ªïi, h√†o h·ª©ng", e: "She was ebullient after her team won the championship."},
        {w: "Eclectic", i: "/…™Ààklekt…™k/", m: "ƒêa d·∫°ng", e: "Her musical tastes are quite eclectic."},
        {w: "Efficacy", i: "/Ààef…™k…ôsi/", m: "T√≠nh hi·ªáu qu·∫£", e: "The drug's efficacy has been proven in clinical trials."},
        {w: "Elusive", i: "/…™ÀàluÀês…™v/", m: "Kh√≥ n·∫Øm b·∫Øt", e: "Success can be elusive for many artists."},
        {w: "Eminent", i: "/Ààem…™n…ônt/", m: "Xu·∫•t ch√∫ng, l·ªói l·∫°c", e: "He is an eminent professor of linguistics."},
        {w: "Emulate", i: "/Ààemjule…™t/", m: "Thi ƒëua, b·∫Øt ch∆∞·ªõc", e: "Children often try to emulate their parents."},
        {w: "Enervate", i: "/Ààen…ôve…™t/", m: "L√†m suy ki·ªát s·ª©c l·ª±c", e: "The humid heat enervates even the strongest people."},
        {w: "Engender", i: "/…™nÀàd íend…ô(r)/", m: "G√¢y ra", e: "The policy helped to engender a sense of community."},
        {w: "Enigma", i: "/…™Ààn…™…°m…ô/", m: "ƒêi·ªÅu b√≠ ·∫©n", e: "His sudden disappearance remains an enigma."},
        {w: "Ephemeral", i: "/…™Ààfem…ôr…ôl/", m: "Ch√≥ng v√°nh, ph√π du", e: "Fame in the social media era is often ephemeral."},
        {w: "Equanimity", i: "/Àåekw…ôÀàn…™m…ôti/", m: "S·ª± ƒëi·ªÅm tƒ©nh", e: "She faced the crisis with perfect equanimity."},
        {w: "Eradicate", i: "/…™Ààr√¶d…™ke…™t/", m: "Di·ªát tr·ª´ t·∫≠n g·ªëc", e: "The disease has been almost eradicated."},
        {w: "Erratic", i: "/…™Ààr√¶t…™k/", m: "Th·∫•t th∆∞·ªùng", e: "The car's erratic movements worried the police."},
        {w: "Erudite", i: "/Ààeruda…™t/", m: "Th√¥ng th√°i", e: "He gave an erudite lecture on history."},
        {w: "Esoteric", i: "/Àåes…ôÀàter…™k/", m: "Th√¢m th√∫y (√≠t ng∆∞·ªùi bi·∫øt)", e: "The discussion was full of esoteric terminology."},
        {w: "Exemplary", i: "/…™…°Ààzempl…ôri/", m: "M·∫´u m·ª±c, g∆∞∆°ng m·∫´u", e: "His behavior in class has been exemplary."},
        {w: "Exhaustive", i: "/…°Ààz…îÀêst…™v/", m: "To√†n di·ªán, th·∫•u ƒë√°o", e: "The police conducted an exhaustive search."},
        {w: "Exhilarating", i: "/…™…°Ààz…™l…ôre…™t…™≈ã/", m: "L√†m ph·∫•n ch·∫•n", e: "Skydiving is an exhilarating experience."},
        {w: "Exonerate", i: "/…™…°Ààz…ín…ôre…™t/", m: "Gi·∫£i oan", e: "The DNA evidence helped to exonerate him."},
        {w: "Expedient", i: "/…™kÀàspiÀêdi…ônt/", m: "Th·ª±c t·∫ø, c√≥ l·ª£i", e: "The company found it expedient to settle out of court."},
        {w: "Explicit", i: "/…™kÀàspl…™s…™t/", m: "R√µ r√†ng", e: "I gave you explicit instructions to stay here."},
        {w: "Exploit", i: "/…™kÀàspl…î…™t/", m: "Khai th√°c, l·ª£i d·ª•ng", e: "We need to exploit renewable energy sources."},
        {w: "Extol", i: "/…™kÀàst…ô äl/", m: "T√°n d∆∞∆°ng", e: "Doctors extol the virtues of regular exercise."},
        {w: "Facilitate", i: "/f…ôÀàs…™l…™te…™t/", m: "T·∫°o ƒëi·ªÅu ki·ªán thu·∫≠n l·ª£i", e: "Modern technology facilitates remote work."},
        {w: "Fallacious", i: "/f…ôÀàle…™ É…ôs/", m: "Sai l·∫ßm", e: "His argument is based on fallacious reasoning."},
        {w: "Fastidious", i: "/f√¶Ààst…™di…ôs/", m: "C·∫ßu k·ª≥, kƒ© t√≠nh", e: "He is very fastidious about his clothes."},
        {w: "Fervent", i: "/Ààf…úÀêv…ônt/", m: "N·ªìng nhi·ªát, tha thi·∫øt", e: "She is a fervent believer in social justice."},
        {w: "Fortuitous", i: "/f…îÀêÀàtjuÀê…™t…ôs/", m: "Ng·∫´u nhi√™n may m·∫Øn", e: "Our meeting was entirely fortuitous."},
        {w: "Frugal", i: "/ÀàfruÀê…°l/", m: "Ti·∫øt ki·ªám", e: "He lives a frugal life to save money."},
        {w: "Futile", i: "/ÀàfjuÀêta…™l/", m: "V√¥ √≠ch", e: "It's futile to argue with him."},
        {w: "Gregarious", i: "/…°r…™Àà…°e…ôri…ôs/", m: "Th√≠ch giao du", e: "She is a gregarious person who loves parties."},
        {w: "Gullible", i: "/Àà…° ål…ôbl/", m: "D·ªÖ tin, nh·∫π d·∫°", e: "Don't be so gullible as to believe that."},
        {w: "Hamper", i: "/Ààh√¶mp…ô(r)/", m: "C·∫£n tr·ªü", e: "Bad weather hampered the rescue efforts."},
        {w: "Haphazard", i: "/h√¶pÀàh√¶z…ôd/", m: "L·ªôn x·ªôn, ng·∫´u nhi√™n", e: "The books were piled in a haphazard way."},
        {w: "Hierarchy", i: "/Ààha…™…ôr…ëÀêki/", m: "H·ªá th·ªëng c·∫•p b·∫≠c", e: "There is a strict hierarchy in the army."},
        {w: "Hindrance", i: "/Ààh…™ndr…ôns/", m: "S·ª± c·∫£n tr·ªü", e: "The rain was a hindrance to our work."},
        {w: "Imminent", i: "/Àà…™m…™n…ônt/", m: "S·∫Øp x·∫£y ra", e: "A decision is expected imminent."},
        {w: "Immutable", i: "/…™ÀàmjuÀêt…ôbl/", m: "Kh√¥ng thay ƒë·ªïi ƒë∆∞·ª£c", e: "The laws of nature are immutable."},
        {w: "Impair", i: "/…™mÀàpe…ô(r)/", m: "L√†m suy y·∫øu, h·ªèng", e: "Alcohol can impair your driving ability."},
        {w: "Impartial", i: "/…™mÀàp…ëÀê Él/", m: "C√¥ng b·∫±ng", e: "A judge must remain impartial."},
        {w: "Impede", i: "/…™mÀàpiÀêd/", m: "C·∫£n tr·ªü (ti·∫øn tr√¨nh)", e: "Storms can impede the progress of the ship."},
        {w: "Imperative", i: "/…™mÀàper…ôt…™v/", m: "C·∫•p b√°ch, b·∫Øt bu·ªôc", e: "It is imperative that you leave now."},
        {w: "Implicit", i: "/…™mÀàpl…™s…™t/", m: "Ng·∫ßm hi·ªÉu", e: "There was an implicit agreement between them."},
        {w: "Incentive", i: "/…™nÀàsent…™v/", m: "S·ª± kh√≠ch l·ªá", e: "Bonus payments provide an incentive to work harder."},
        {w: "Incessant", i: "/…™nÀàsesnt/", m: "Li√™n mi√™n kh√¥ng d·ª©t", e: "The incessant noise made it hard to sleep."},
        {w: "Incisive", i: "/…™nÀàsa…™s…™v/", m: "S·∫Øc s·∫£o", e: "She wrote an incisive analysis of the situation."},
        {w: "Incongruous", i: "/…™nÀàk…í≈ã…°ru…ôs/", m: "Kh√¥ng ph√π h·ª£p", e: "The modern chair looked incongruous in the old room."},
        {w: "Indigenous", i: "/…™nÀàd…™d í…ôn…ôs/", m: "B·∫£n ƒë·ªãa", e: "Kangaroos are indigenous to Australia."},
        {w: "Indifferent", i: "/…™nÀàd…™fr…ônt/", m: "Th·ªù ∆°", e: "He was indifferent to the suffering of others."},
        {w: "Indolent", i: "/Àà…™nd…ôl…ônt/", m: "L∆∞·ªùi bi·∫øng", e: "The indolent student failed the exam."},
        {w: "Inevitable", i: "/…™nÀàev…™t…ôbl/", m: "Kh√¥ng th·ªÉ tr√°nh kh·ªèi", e: "Death is inevitable."},
        {w: "Inherent", i: "/…™nÀàh…™…ôr…ônt/", m: "V·ªën c√≥", e: "Every job has inherent risks."},
        {w: "Inhibit", i: "/…™nÀàh…™b…™t/", m: "NgƒÉn ch·∫∑n, ki·ªÅm ch·∫ø", e: "Strict rules can inhibit creativity."},
        {w: "Innate", i: "/…™Ààne…™t/", m: "B·∫©m sinh", e: "She has an innate talent for music."},
        {w: "Innocuous", i: "/…™Ààn…íkju…ôs/", m: "V√¥ h·∫°i", e: "It was an innocuous comment, but he took it personally."},
        {w: "Insatiable", i: "/…™nÀàse…™ É…ôbl/", m: "Kh√¥ng th·ªÉ th·ªèa m√£n", e: "The child has an insatiable curiosity."},
        {w: "Inscrutable", i: "/…™nÀàskruÀêt…ôbl/", m: "B√≠ hi·ªÉm, kh√≥ nh√¨n th·∫•u", e: "He had an inscrutable expression on his face."},
        {w: "Insidious", i: "/…™nÀàs…™di…ôs/", m: "X·∫£o quy·ªát, √¢m ·ªâ", e: "The disease is insidious and hard to detect."},
        {w: "Insipid", i: "/…™nÀàs…™p…™d/", m: "Nh·∫°t nh·∫Ωo", e: "The soup was rather insipid."},
        {w: "Instigate", i: "/Àà…™nst…™…°e…™t/", m: "X√∫i gi·ª•c, kh·ªüi x∆∞·ªõng", e: "They tried to instigate a protest."},
        {w: "Intangible", i: "/…™nÀàt√¶nd í…ôbl/", m: "V√¥ h√¨nh", e: "Trust is an intangible asset."},
        {w: "Integral", i: "/Àà…™nt…™…°r…ôl/", m: "Thi·∫øt y·∫øu", e: "Music is an integral part of his life."},
        {w: "Integrity", i: "/…™nÀàte…°r…ôti/", m: "S·ª± ch√≠nh tr·ª±c", e: "He is a man of great integrity."},
        {w: "Intermittent", i: "/Àå…™nt…ôÀàm…™t…ônt/", m: "Gi√°n ƒëo·∫°n, l√∫c c√≥ l√∫c kh√¥ng", e: "There will be intermittent rain today."},
        {w: "Intervene", i: "/Àå…™nt…ôÀàviÀên/", m: "Can thi·ªáp", e: "The UN had to intervene in the conflict."},
        {w: "Intrepid", i: "/…™nÀàtrep…™d/", m: "Gan d·∫°", e: "The intrepid traveler set off alone."},
        {w: "Intrinsic", i: "/…™nÀàtr…™nz…™k/", m: "B·∫£n ch·∫•t", e: "Flexibility is intrinsic to our business model."},
        {w: "Inundate", i: "/Àà…™n ånde…™t/", m: "Tr√†n ng·∫≠p", e: "We were inundated with applications for the job."}
    ];

    const synth = window.speechSynthesis;
    let userVocab = [];

    // --- HELPER FUNCTIONS ---
    function isMobile() {
        return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    function capitalize(str) {
        if (!str) return "";
        str = str.trim();
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function cleanPrefix(str) {
        // Lo·∫°i b·ªè s·ªë th·ª© t·ª± (1., 1), g·∫°ch ƒë·∫ßu d√≤ng (-, *), kho·∫£ng tr·∫Øng d∆∞ th·ª´a ·ªü ƒë·∫ßu
        return str.replace(/^[\s\d.\-\*)\>]+/, "").trim();
    }

    // --- AUDIO LOGIC (HYBRID) ---
    function speak(text) {
        synth.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';

        if (isMobile()) {
            setTimeout(() => {
                const voices = synth.getVoices();
                const bestVoice = voices.find(v => v.name.includes('Google') && v.lang.includes('en-US')) ||
                                 voices.find(v => v.name.includes('Siri') && v.lang.includes('en-US')) ||
                                 voices.find(v => v.lang.includes('en-US'));
                if(bestVoice) msg.voice = bestVoice;
                msg.rate = 0.85;
                synth.speak(msg);
            }, 50);
        } else {
            msg.rate = 0.8;
            synth.speak(msg);
        }
    }

    function unlockAudio() {
        if (isMobile()) {
            const ut = new SpeechSynthesisUtterance(' ');
            ut.volume = 0;
            synth.speak(ut);
        }
    }

    // --- CORE LOGIC ---
    function parseLines(text) {
        userVocab = [];
        text.split('\n').forEach(line => {
            if(line.includes(':')) {
                const parts = line.split(':');
                let rawWord = cleanPrefix(parts[0]);
                let rawMeaning = parts[1].trim();

                if (rawWord && rawMeaning) {
                    userVocab.push({
                        w: capitalize(rawWord),
                        m: capitalize(rawMeaning),
                        e: "Practice makes perfect!"
                    });
                }
            }
        });
        if(userVocab.length > 0) {
            unlockAudio();
            generateQuiz();
        }
    }

    function processText() {
        const val = document.getElementById('rawInput').value;
        if(!val) return alert("Please enter your vocabulary list!");
        parseLines(val);
    }

    document.getElementById('fileIn').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(!file) return;
        document.getElementById('fileInfo').innerText = "File loaded: " + file.name;
        const reader = new FileReader();
        reader.onload = (ev) => {
            mammoth.extractRawText({ arrayBuffer: ev.target.result }).then(res => parseLines(res.value));
        };
        reader.readAsArrayBuffer(file);
    });

    function generateQuiz() {
        const container = document.getElementById('quizContent');
        container.innerHTML = '';
        document.getElementById('scoreBox').style.display = 'none';
        document.getElementById('quizArea').style.display = 'block';

        let pool = [...userVocab];
        if(pool.length < 20) {
            let shuffledBank = [...megaBank].sort(() => 0.5 - Math.random());
            for(let item of shuffledBank) {
                if(pool.length >= 20) break;
                if(!pool.some(x => x.w.toLowerCase() === item.w.toLowerCase())) {
                    pool.push(item);
                }
            }
        }
        
        let quiz20 = pool.sort(() => 0.5 - Math.random()).slice(0, 20);

        quiz20.forEach((item, idx) => {
            const isEngQ = Math.random() > 0.5;
            const qTxt = isEngQ ? `Meaning of "<strong>${item.w}</strong>"?` : `Which word means: "<strong>${item.m}</strong>"?`;
            const correctAns = isEngQ ? item.m : item.w;
            
            let others = quiz20.filter(x => x.w !== item.w).map(x => isEngQ ? x.m : x.w);
            let opts = [correctAns, ...others.sort(() => 0.5 - Math.random()).slice(0, 3)].sort(() => 0.5 - Math.random());

            container.innerHTML += `
                <div class="q-card" data-correct="${correctAns}">
                    <div class="q-text">${idx+1}. ${qTxt}</div>
                    <div class="options">
                        ${opts.map(o => `<div class="opt" onclick="selectOpt(this)">${o}</div>`).join('')}
                    </div>
                    <div class="feedback">
                        <div class="ipa-line">
                            <span class="ipa-text">${item.w}</span>
                            <button class="speak-btn" onclick="speak('${item.w}')">üîä</button>
                        </div>
                        <p><strong>Example:</strong> ${item.e}</p>
                    </div>
                </div>
            `;
        });
        window.scrollTo({ top: document.getElementById('quizArea').offsetTop, behavior: 'smooth' });
    }

    function selectOpt(el) {
        el.parentElement.querySelectorAll('.opt').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
    }

    function checkAll() {
        const cards = document.querySelectorAll('.q-card');
        let score = 0;
        cards.forEach(card => {
            const sel = card.querySelector('.opt.selected');
            const cor = card.getAttribute('data-correct');
            const fb = card.querySelector('.feedback');
            fb.style.display = 'block';

            if(sel && sel.innerText === cor) {
                score++;
                fb.style.borderLeftColor = "var(--secondary)";
            } else {
                fb.style.borderLeftColor = "var(--danger)";
                fb.innerHTML = `<div style="color:var(--danger); font-weight:bold; margin-bottom:8px;">‚ùå Not quite! Correct: ${cor}</div>` + fb.innerHTML;
            }
        });

        const box = document.getElementById('scoreBox');
        box.style.display = 'block';
        box.innerHTML = `<h2>Score: ${score}/20</h2><p>Tap üîä to master your pronunciation.</p>`;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function switchTab(id, btn) {
        document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }
</script>

</body>
</html>
